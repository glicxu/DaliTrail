<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DaliTrail</title>
  <link rel="manifest" href="/manifest.webmanifest"/>
  <meta name="theme-color" content="#2b7ff6"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180.png"/>
  <link rel="apple-touch-icon" sizes="192x192" href="/assets/icons/icon-192.png"/>
  <link rel="apple-touch-icon" sizes="512x512" href="/assets/icons/icon-512.png"/>
  <link rel="stylesheet" href="assets/style.css"/>

  <!-- Preload ESM deps -->
  <link rel="modulepreload" href="/assets/js/utils.js"/>
  <link rel="modulepreload" href="/assets/js/location.js"/>
  <link rel="modulepreload" href="/assets/js/walk.js"/>
  <link rel="modulepreload" href="/assets/js/kml-import.js"/>
  <link rel="modulepreload" href="/assets/js/sketch-map.js"/>,
  <link rel="modulepreload" href="/assets/js/search.js"/>
  <link rel="modulepreload" href="/assets/js/main.js"/>,
  <link rel="modulepreload" href="/assets/js/notes.js"/>,
  <link rel="modulepreload" href="/assets/js/events.js"/>,
</head>
<body>
  <main class="app" data-view="home">
    <header class="app-header">
    <button class="btn btn-outline back-btn" id="back-btn" hidden aria-label="Back">
    <!-- Left arrow icon -->
    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
      <path d="M14 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
      <div>
        <h1>DaliTrail</h1>
      </div>
    </header>

    <p class="status-text global-status" id="status-text" role="status" hidden></p>

    <section class="view home-view" data-view="home">

      <div class="home-actions">
        <button class="btn btn-primary" id="open-location-view-btn">Location</button>

        <button class="btn btn-primary" id="open-event-view-btn">Event</button>
        <button class="btn btn-primary" id="open-notes-view-btn">Note</button>
      </div>
      <button class="icon-btn about-btn" id="open-about-view-btn" aria-label="About DaliTrail">
        <span class="ellipsis-icon" aria-hidden="true"><span></span><span></span><span></span></span>
      </button>
    </section>

    <section class="view about-view" data-view="about" hidden>
      <h2>About</h2>
      <p class="section-copy">Manage the app on your device and keep it up to date.</p>

      <details class="about-panel install" hidden>
        <summary>
          <div class="about-panel-header">
            <span class="about-panel-title">Install</span>
            <span class="about-panel-summary">Add DaliTrail for a full-screen experience.</span>
          </div>
        </summary>
        <div class="about-panel-body">
          <div class="install-actions">
            <p class="install-note status-text" id="install-hint">Install instructions will update based on your device.</p>
            <button class="btn btn-primary" id="install-btn">Install App</button>
            <p class="status-text" id="install-status" role="status">Tap Install to add DaliTrail. We’ll guide you if anything else is needed.</p>
          </div>
        </div>
      </details>

      <details class="about-panel update" id="update-section" hidden>
        <summary>
          <div class="about-panel-header">
            <span class="about-panel-title">Update</span>
            <span class="about-panel-summary">Download the latest improvements without leaving the app.</span>
          </div>
        </summary>
        <div class="about-panel-body">
          <button class="btn btn-outline" id="update-btn">Check for Updates</button>
        </div>
      </details>

      <details class="about-panel geonames" id="geonames-section" open>
        <summary>
          <div class="about-panel-header">
            <span class="about-panel-title">GeoNames Data</span>
            <span class="about-panel-summary">Connect a GeoNames SQLite database to search nearby features.</span>
          </div>
        </summary>
        <div class="about-panel-body">
          <div class="geonames-actions">
            <button class="btn btn-outline" type="button" id="geonames-download-btn">Download GeoNames</button>
            <button class="btn btn-outline" type="button" id="geonames-connect-btn">Select Existing DB</button>
            <button class="btn icon-btn geonames-manage-btn" type="button" id="geonames-manage-btn" aria-label="Manage GeoNames data">
              <span class="ellipsis-icon" aria-hidden="true"><span></span><span></span><span></span></span>
            </button>
          </div>
          <p class="status-text geonames-status" id="geonames-status" role="status">No GeoNames database connected yet.</p>
          <div class="geonames-download-panel" id="geonames-download-panel" hidden>
            <label for="geonames-download-select">Choose a region</label>
            <select id="geonames-download-select"></select>
            <button class="btn btn-primary" type="button" id="geonames-download-confirm">Download &amp; Connect</button>
            <p class="status-text" id="geonames-download-status">Select a dataset to begin.</p>
          </div>
          <input type="file" id="geonames-file-input" accept=".db,.sqlite,application/octet-stream" hidden/>
        </div>
      </details>

      <details class="about-panel backup" id="backup-section">
        <summary>
          <div class="about-panel-header">
            <span class="about-panel-title">Backup & Restore</span>
            <span class="about-panel-summary">Save or load your locations, notes, and preferences.</span>
          </div>
        </summary>
        <div class="about-panel-body">
          <div class="backup-actions">
            <button class="btn btn-outline" type="button" id="backup-download-btn">Download Backup</button>
            <button class="btn btn-outline" type="button" id="backup-restore-btn">Restore from File</button>
          </div>
          <p class="status-text" id="backup-status" role="status">Back up your saved data to a file and restore it later if you switch devices.</p>
          <input type="file" id="backup-file-input" accept="application/json,application/octet-stream" hidden/>
        </div>
      </details>

      <details class="about-panel log" hidden>
        <summary>
          <div class="about-panel-header">
            <span class="about-panel-title">Activity Log</span>
            <span class="about-panel-summary">Review install prompts, downloads, and debug notes.</span>
          </div>
        </summary>
        <div class="about-panel-body">
          <ul id="log"></ul>
        </div>
      </details>

      <section class="log-toggle">
        <button class="btn btn-outline" id="toggle-log-btn" aria-expanded="false">Show Log</button>
      </section>
    </section>

    <section class="view location-view" data-view="location" hidden>
  
      <!-- Status line -->
      <p id="location-status" class="status-text">No locations saved yet.</p>

      <!-- Latest + Sun/Moon -->
      <section class="latest-location">
        <h3>Latest Location</h3>
        <div id="latest-location-card" class="location-card empty" aria-live="polite">
          <p class="status-text">No locations saved yet.</p>
        </div>

        <section class="sun-card" id="sun-card" hidden>

          <p><strong>Sunrise:</strong> <span id="sunrise-text">—</span></p>
          <p><strong>Sunset:</strong> <span id="sunset-text">—</span></p>
        </section>

        <section id="moon-card" class="sun-card" hidden>
          <p><strong>Moonrise:</strong> <span id="moonrise-text">—</span></p>
          <p><strong>Moonset:</strong> <span id="moonset-text">—</span></p>
          <p><strong>Phase:</strong> <span id="moonphase-text">—</span></p>
        </section>
      </section>

      <button class="btn btn-outline" id="open-location-history-btn" disabled>Previous Locations</button>
    </section>

    <section class="view search-view" data-view="search" hidden>
      <h2>Search Nearby</h2>
      <p class="section-copy">Explore points of interest near your most recent location.</p>

      <section class="search-location-card" id="search-location-card" hidden>
        <h3>Selected Location</h3>
        <div class="search-location-summary" id="search-location-summary"></div>
        <p class="status-text" id="search-location-status">Looking up nearby place names…</p>
      </section>

      <p class="status-text" id="search-dataset-info" hidden></p>

      <section class="search-actions" id="search-actions" hidden>
        <h3>Search Places of Interest</h3>
        <form id="search-nearby-form" class="search-form">
          <label>
            Radius (km)
            <input type="number" id="search-radius" min="1" max="100" step="1" value="5"/>
          </label>
          <label>
            Category
            <select id="search-category">
              <option value="all">All features</option>
              <option value="trails">Trails & routes</option>
              <option value="water">Water</option>
              <option value="peaks">Mountains & peaks</option>
              <option value="towns">Towns & cities</option>
              <option value="parks">Parks & recreation</option>
            </select>
          </label>
          <label>
            Limit
            <input type="number" id="search-limit" min="1" max="100" step="1" value="20"/>
          </label>
          <button class="btn btn-primary" type="submit">Search Nearby</button>
        </form>
      </section>

      <section class="search-results" id="search-results-section" hidden>
        <h3>Nearby Places</h3>
        <p class="status-text" id="search-results-status">Run a search to see suggested places around your location.</p>
        <ul id="search-results-list" class="search-results-list"></ul>
      </section>

      <div class="search-results-actions history-actions" id="search-results-actions" hidden>
        <button class="btn btn-primary" type="button" id="search-results-view-btn" disabled>View on Map</button>
        <button class="btn btn-outline" type="button" id="search-results-save-btn" disabled>Save to Locations</button>
        <button class="btn btn-outline" type="button" id="search-results-share-btn" disabled>Share</button>
        <button class="btn btn-outline" type="button" id="search-results-sketch-btn" disabled>Sketch Map</button>
      </div>
    </section>

    <section class="view location-history-view" data-view="location-history" hidden>
      <h2>Saved Locations</h2>
      <p class="section-copy">Select the points you want to share or view on a map.</p>

      <ul id="locations-list"></ul>
      <p id="location-history-status" class="status-text">No saved locations yet.</p>

      <div class="history-actions">
        <button class="btn btn-primary" id="history-view-btn" disabled>View on Map</button>
        <button class="btn btn-outline" id="history-share-btn" disabled>Share</button>
        <button class="btn btn-danger" id="history-delete-btn" disabled>Delete</button>
        <!-- Walk / Sketch are injected by JS -->
      </div>
    </section>

    <section class="view event-view" data-view="events" hidden>
      <h2>Events</h2>
      <p class="section-copy">Plan upcoming outings and share them with your calendar.</p>

      <form class="event-editor" id="event-form">
        <div class="form-row">
          <label for="event-datetime">Date & time</label>
          <input type="datetime-local" id="event-datetime" required/>
        </div>
        <div class="form-row">
          <label for="event-note">Event note</label>
          <textarea id="event-note" rows="3" placeholder="Add details, meeting spot, or reminders"></textarea>
        </div>
        <div class="event-editor-actions">
          <button class="btn btn-primary" type="submit" id="event-save-btn">Add Event</button>
          <button class="btn btn-outline" type="button" id="event-cancel-edit-btn" hidden>Cancel Edit</button>
        </div>
      </form>

      <ul class="events-list" id="events-list"></ul>
      <p class="status-text" id="events-status">No events scheduled yet.</p>
    </section>

    <section class="view notes-view" data-view="notes" hidden>
      <div class="notes-editor">
        <label for="note-input" class="visually-hidden">New note</label>
        <textarea id="note-input" placeholder="Type a quick note…"></textarea>
        <button class="btn btn-primary" id="add-note-btn">Add</button>
        </div>

        <ul class="notes-list" id="notes-list"></ul>
        <p id="notes-status" class="status-text">No notes yet.</p>
    </section>

 </main>

  <script type="module" src="/assets/js/main.js"></script>
</body>
</html>

